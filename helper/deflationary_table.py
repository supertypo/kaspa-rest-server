import math

from constants import BPS

SUBSIDY_BY_MONTH_TABLE = [
    44000000000,
    41530469757,
    39199543598,
    36999442271,
    34922823143,
    32962755691,
    31112698372,
    29366476791,
    27718263097,
    26162556530,
    24694165062,
    23308188075,
    22000000000,
    20765234878,
    19599771799,
    18499721135,
    17461411571,
    16481377845,
    15556349186,
    14683238395,
    13859131548,
    13081278265,
    12347082531,
    11654094037,
    11000000000,
    10382617439,
    9799885899,
    9249860567,
    8730705785,
    8240688922,
    7778174593,
    7341619197,
    6929565774,
    6540639132,
    6173541265,
    5827047018,
    5500000000,
    5191308719,
    4899942949,
    4624930283,
    4365352892,
    4120344461,
    3889087296,
    3670809598,
    3464782887,
    3270319566,
    3086770632,
    2913523509,
    2750000000,
    2595654359,
    2449971474,
    2312465141,
    2182676446,
    2060172230,
    1944543648,
    1835404799,
    1732391443,
    1635159783,
    1543385316,
    1456761754,
    1375000000,
    1297827179,
    1224985737,
    1156232570,
    1091338223,
    1030086115,
    972271824,
    917702399,
    866195721,
    817579891,
    771692658,
    728380877,
    687500000,
    648913589,
    612492868,
    578116285,
    545669111,
    515043057,
    486135912,
    458851199,
    433097860,
    408789945,
    385846329,
    364190438,
    343750000,
    324456794,
    306246434,
    289058142,
    272834555,
    257521528,
    243067956,
    229425599,
    216548930,
    204394972,
    192923164,
    182095219,
    171875000,
    162228397,
    153123217,
    144529071,
    136417277,
    128760764,
    121533978,
    114712799,
    108274465,
    102197486,
    96461582,
    91047609,
    85937500,
    81114198,
    76561608,
    72264535,
    68208638,
    64380382,
    60766989,
    57356399,
    54137232,
    51098743,
    48230791,
    45523804,
    42968750,
    40557099,
    38280804,
    36132267,
    34104319,
    32190191,
    30383494,
    28678199,
    27068616,
    25549371,
    24115395,
    22761902,
    21484375,
    20278549,
    19140402,
    18066133,
    17052159,
    16095095,
    15191747,
    14339099,
    13534308,
    12774685,
    12057697,
    11380951,
    10742187,
    10139274,
    9570201,
    9033066,
    8526079,
    8047547,
    7595873,
    7169549,
    6767154,
    6387342,
    6028848,
    5690475,
    5371093,
    5069637,
    4785100,
    4516533,
    4263039,
    4023773,
    3797936,
    3584774,
    3383577,
    3193671,
    3014424,
    2845237,
    2685546,
    2534818,
    2392550,
    2258266,
    2131519,
    2011886,
    1898968,
    1792387,
    1691788,
    1596835,
    1507212,
    1422618,
    1342773,
    1267409,
    1196275,
    1129133,
    1065759,
    1005943,
    949484,
    896193,
    845894,
    798417,
    753606,
    711309,
    671386,
    633704,
    598137,
    564566,
    532879,
    502971,
    474742,
    448096,
    422947,
    399208,
    376803,
    355654,
    335693,
    316852,
    299068,
    282283,
    266439,
    251485,
    237371,
    224048,
    211473,
    199604,
    188401,
    177827,
    167846,
    158426,
    149534,
    141141,
    133219,
    125742,
    118685,
    112024,
    105736,
    99802,
    94200,
    88913,
    83923,
    79213,
    74767,
    70570,
    66609,
    62871,
    59342,
    56012,
    52868,
    49901,
    47100,
    44456,
    41961,
    39606,
    37383,
    35285,
    33304,
    31435,
    29671,
    28006,
    26434,
    24950,
    23550,
    22228,
    20980,
    19803,
    18691,
    17642,
    16652,
    15717,
    14835,
    14003,
    13217,
    12475,
    11775,
    11114,
    10490,
    9901,
    9345,
    8821,
    8326,
    7858,
    7417,
    7001,
    6608,
    6237,
    5887,
    5557,
    5245,
    4950,
    4672,
    4410,
    4163,
    3929,
    3708,
    3500,
    3304,
    3118,
    2943,
    2778,
    2622,
    2475,
    2336,
    2205,
    2081,
    1964,
    1854,
    1750,
    1652,
    1559,
    1471,
    1389,
    1311,
    1237,
    1168,
    1102,
    1040,
    982,
    927,
    875,
    826,
    779,
    735,
    694,
    655,
    618,
    584,
    551,
    520,
    491,
    463,
    437,
    413,
    389,
    367,
    347,
    327,
    309,
    292,
    275,
    260,
    245,
    231,
    218,
    206,
    194,
    183,
    173,
    163,
    154,
    146,
    137,
    130,
    122,
    115,
    109,
    103,
    97,
    91,
    86,
    81,
    77,
    73,
    68,
    65,
    61,
    57,
    54,
    51,
    48,
    45,
    43,
    40,
    38,
    36,
    34,
    32,
    30,
    28,
    27,
    25,
    24,
    22,
    21,
    20,
    19,
    18,
    17,
    16,
    15,
    14,
    13,
    12,
    12,
    11,
    10,
    10,
    9,
    9,
    8,
    8,
    7,
    7,
    6,
    6,
    6,
    5,
    5,
    5,
    4,
    4,
    4,
    4,
    3,
    3,
    3,
    3,
    3,
    2,
    2,
    2,
    2,
    2,
    2,
    2,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    0,
]

SECONDS_PER_MONTH = 30.4375 * 24 * 60 * 60
DAA_CRESCENDO = 110_165_000
DAA_DEFLATIONARY_PHASE = 15778800


def subsidy_month(daa_score: int):
    # Count seconds before and after Crescendo activation
    total_seconds = (DAA_CRESCENDO - (DAA_DEFLATIONARY_PHASE - 259200)) + (daa_score - DAA_CRESCENDO) / BPS
    return int(total_seconds // SECONDS_PER_MONTH)


def daa_from_month(month: int):
    """revert subsidy function"""
    return int((month * SECONDS_PER_MONTH - (DAA_CRESCENDO - (DAA_DEFLATIONARY_PHASE - 259200))) * BPS + DAA_CRESCENDO)


def calc_block_reward(daa):
    month = subsidy_month(daa)
    return {
        "current": math.ceil(SUBSIDY_BY_MONTH_TABLE[month] / BPS) / 1_0000_0000,
        "next": math.ceil(SUBSIDY_BY_MONTH_TABLE[month + 1] / BPS) / 1_0000_0000,
        "daa_next_halving": daa_from_month(month + 1),
    }
